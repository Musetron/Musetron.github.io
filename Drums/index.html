<!DOCTYPE html>
<html lang="de">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  background:#111;
  color:#eee;
  font-family:Arial, sans-serif;
  text-align:center;
  padding-top:20px;
}
h2 {
  margin-bottom:20px;
  color:#0ff;
  text-shadow:0 0 10px #0ff;
}
.drumgrid {
  display:grid;
  grid-template-columns:repeat(3,100px);
  gap:12px;
  margin:auto;
  width:330px;
}
button {
  background:#222;
  border:2px solid #333;
  border-radius:12px;
  padding:18px 0;
  font-size:18px;
  color:#0ff;
  text-shadow:0 0 5px #0ff;
  box-shadow:0 0 8px #000 inset;
  transition:0.08s ease;
  user-select:none;
}
button:active {
  transform:scale(0.95);
  background:#0ff;
  color:#000;
  text-shadow:none;
  box-shadow:0 0 12px #0ff;
}
button:hover {
  border-color:#0ff;
  box-shadow:0 0 8px #0ff;
}
</style>
</head>
<body>

<h2>Drum Machine</h2>

<div class="drumgrid">
  <button data-sound="k">K</button>
  <button data-sound="s">S</button>
  <button data-sound="hh">HH</button>

  <button data-sound="c">C</button>
  <button data-sound="bd">BD</button>
  <button data-sound="ohh">OHH</button>

  <button data-sound="t1">T1</button>
  <button data-sound="t2">T2</button>
  <button data-sound="t3">T3</button>
</div>

<script>
// ------------------------
// SOUND URLs
// ------------------------
const urls = {
  k:  "https://github.com/Musetron/musetron.github.io/raw/refs/heads/main/Drums/k.wav",
  s:  "https://github.com/Musetron/musetron.github.io/raw/refs/heads/main/Drums/s.wav",
  hh: "https://github.com/Musetron/musetron.github.io/raw/refs/heads/main/Drums/hh.wav",
  c:  "https://github.com/Musetron/musetron.github.io/raw/refs/heads/main/Drums/c.wav",
  bd: "https://github.com/Musetron/musetron.github.io/raw/refs/heads/main/Drums/bd.wav",
  ohh:"https://github.com/Musetron/musetron.github.io/raw/refs/heads/main/Drums/ohh.wav",
  t1: "https://github.com/Musetron/musetron.github.io/raw/refs/heads/main/Drums/t1.wav",
  t2: "https://github.com/Musetron/musetron.github.io/raw/refs/heads/main/Drums/t2.wav",
  t3: "https://github.com/Musetron/musetron.github.io/raw/refs/heads/main/Drums/t3.wav"
};

let audioCtx;
let buffers = {};
let audioUnlocked = false;

// ------------------------
// UNLOCK + PRELOAD
// ------------------------
async function unlockAndLoad() {
  if (audioUnlocked) return;
  audioUnlocked = true;

  audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  // Android Chrome unlock hack: play silent buffer
  const silent = audioCtx.createBuffer(1, 1, 22050);
  const src = audioCtx.createBufferSource();
  src.buffer = silent;
  src.connect(audioCtx.destination);
  src.start(0);

  await audioCtx.resume();

  // PRELOAD AUDIO
  const keys = Object.keys(urls);
  await Promise.all(
    keys.map(async (key) => {
      const arr = await fetch(urls[key]).then(r => r.arrayBuffer());
      buffers[key] = await audioCtx.decodeAudioData(arr);
    })
  );

  console.log("Audio unlocked + samples loaded");
}

function ensureAudio() {
  if (!audioUnlocked) unlockAndLoad();
  if (audioCtx && audioCtx.state === "suspended") audioCtx.resume();
}

document.addEventListener("touchstart", ensureAudio, { once: true });
document.addEventListener("click", ensureAudio, { once: true });

// ------------------------
// PLAY SOUND (polyphonic)
// ------------------------
function play(key) {
  ensureAudio();
  const b = buffers[key];
  if (!b) return;

  const s = audioCtx.createBufferSource();
  s.buffer = b;
  s.connect(audioCtx.destination);
  s.start(0);
}

// Buttons
document.querySelectorAll("button").forEach(btn =>
  btn.addEventListener("click", () => play(btn.dataset.sound))
);

// Keyboard
const keymap = {
  "Numpad7": "k", "Numpad8": "s", "Numpad9": "hh",
  "Numpad4": "c", "Numpad5": "bd", "Numpad6": "ohh",
  "Numpad1": "t1", "Numpad2": "t2", "Numpad3": "t3"
};

document.addEventListener("keydown", e => {
  if (keymap[e.code]) play(keymap[e.code]);
});

</script>
</body>
  </html>
  
