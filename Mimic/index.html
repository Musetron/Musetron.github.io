<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Wort + Audio Recorder</title>
</head>
<body>
<h1>Wort + Audio Recorder</h1>
<button id="start">Start</button>
<button id="stop">Stop</button>
<div id="log"></div>

<script>
let mediaRecorder;
let audioChunks = [];
let recording = false;
let recognition;
let wordId = 0;

const logDiv = document.getElementById('log');

// Start Recording + Speech Recognition
document.getElementById('start').onclick = async () => {
    // Mikrofon starten
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.start();
    audioChunks = [];

    mediaRecorder.ondataavailable = e => {
        if (recording) audioChunks.push(e.data);
    };

    recording = true;

    // SpeechRecognition
    window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = false;
    recognition.lang = 'de-DE'; // Deutsche Sprache

    recognition.onresult = event => {
        for (let i = event.resultIndex; i < event.results.length; i++) {
            if (event.results[i].isFinal) {
                const word = event.results[i][0].transcript.trim();
                saveWordAudio(word);
            }
        }
    };

    recognition.start();
};

// Stop Recording + Recognition
document.getElementById('stop').onclick = () => {
    recording = false;
    if (mediaRecorder && mediaRecorder.state !== "inactive") mediaRecorder.stop();
    if (recognition) recognition.stop();
};

// Speichert das Audio + Wort
function saveWordAudio(word) {
    if (audioChunks.length === 0) return;

    const blob = new Blob(audioChunks, { type: 'audio/webm' });
    audioChunks = []; // reset für nächste Aufnahme

    // Download-Link erstellen
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `word_${wordId}.webm`;
    a.textContent = `Download word ${wordId}: ${word}`;
    logDiv.appendChild(a);
    logDiv.appendChild(document.createElement('br'));

    console.log("Erkanntes Wort:", word);
    wordId++;
}
</script>
</body>
</html>
