<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini Wort-Recorder</title>
</head>
<body>
<h1>Kleinwort-Erkennung vom Mikrofon</h1>
<button id="start">Start</button>
<button id="stop">Stop</button>
<div id="log"></div>

<script>
let mediaRecorder;
let audioChunks = [];
let recording = false;
let recognition;
let wordId = 0;
const logDiv = document.getElementById('log');

document.getElementById('start').onclick = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.start(250); // alle 250ms chunks

    audioChunks = [];
    mediaRecorder.ondataavailable = e => {
        if (recording) audioChunks.push(e.data);
    };

    recording = true;

    window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.lang = 'de-DE';

    recognition.onresult = event => {
        for (let i = event.resultIndex; i < event.results.length; i++) {
            const res = event.results[i];
            if (res.isFinal) {
                const word = res[0].transcript.trim();
                if(word.length > 0){
                    saveWordAudio(word);
                }
            }
        }
    };

    recognition.start();
};

document.getElementById('stop').onclick = () => {
    recording = false;
    if (mediaRecorder && mediaRecorder.state !== "inactive") mediaRecorder.stop();
    if (recognition) recognition.stop();
};

function saveWordAudio(word){
    if(audioChunks.length === 0) return;

    const blob = new Blob(audioChunks, { type: 'audio/webm' });
    audioChunks = []; // Reset für nächste Aufnahme

    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `word_${wordId}.webm`;
    a.textContent = `Download: ${word}`;
    logDiv.appendChild(a);
    logDiv.appendChild(document.createElement('br'));

    console.log("Erkannt:", word);
    wordId++;
}
</script>
</body>
    </html>
