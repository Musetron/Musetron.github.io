<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Live-Mikrofon-Sterne</title>
<style>
  body { margin: 0; background: black; overflow: hidden; }
  canvas { display: block; }
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Anzahl der Sterne
const numStars = 500;

// Sterne-Objekte
const stars = [];
for (let i = 0; i < numStars; i++) {
  stars.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    baseBrightness: Math.random() * 0.5 + 0.2, // Grundhelligkeit
    brightness: 0
  });
}

// Mikrofonzugriff
navigator.mediaDevices.getUserMedia({ audio: true })
.then(stream => {
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const source = audioCtx.createMediaStreamSource(stream);
  const analyser = audioCtx.createAnalyser();
  analyser.fftSize = 512;  // gröber = stabiler
  source.connect(analyser);

  const bufferLength = analyser.frequencyBinCount;
  const dataArray = new Uint8Array(bufferLength);

  function draw() {
    requestAnimationFrame(draw);

    analyser.getByteTimeDomainData(dataArray);

    ctx.fillStyle = 'black';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Durchschnittliche Lautstärke berechnen
    let sum = 0;
    for (let i = 0; i < bufferLength; i++) {
      sum += Math.abs(dataArray[i] - 128); // Audio-Center = 128
    }
    const avg = sum / bufferLength / 128; // 0..1

    // Sterne zeichnen
    stars.forEach(star => {
      // Helligkeit: Grundhelligkeit + kleine Veränderung durch Audio
      star.brightness = Math.min(1, star.baseBrightness + avg * 0.5);
      const color = Math.floor(star.brightness * 255);
      ctx.fillStyle = `rgb(${color},${color},${color})`;
      ctx.fillRect(star.x, star.y, 2, 2); // kleine Pixel = Stern
    });
  }

  draw();
})
.catch(err => {
  console.error("Mikrofon Zugriff verweigert:", err);
});
</script>
</body>
</html>
