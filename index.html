<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Rausch zu Sätzen</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  #output { margin-top: 20px; white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; min-height: 100px; }
</style>
</head>
<body>
<h1>Mikrofon Rausch → Buchstaben → Deutsche Sätze</h1>
<p>Sprich ins Mikrofon. Bei Pegel über 50% werden Buchstaben erzeugt.</p>
<button id="startBtn">Start</button>
<div id="output"></div>

<script>
// Variablen
let audioContext, analyser, microphone;
let dataArray, bufferLength;

// Funktion: Mikrofon starten
async function startMicrophone() {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    microphone = audioContext.createMediaStreamSource(stream);
    analyser = audioContext.createAnalyser();
    analyser.fftSize = 2048;
    bufferLength = analyser.fftSize;
    dataArray = new Uint8Array(bufferLength);
    microphone.connect(analyser);
    analyzeAudio();
}

// Funktion: Pegel analysieren
function analyzeAudio() {
    analyser.getByteTimeDomainData(dataArray);

    // RMS (Root Mean Square) für Lautstärke
    let sum = 0;
    for(let i = 0; i < bufferLength; i++){
        let val = (dataArray[i] - 128) / 128;
        sum += val * val;
    }
    let rms = Math.sqrt(sum / bufferLength); // 0 bis ~1
    let level = rms * 100; // in Prozent

    if(level > 50) {
        // Erzeuge zufällige Buchstaben und Leerzeichen
        let chars = 'abcdefghijklmnopqrstuvwxyzäöüß ';
        let noiseText = '';
        for(let i = 0; i < 20; i++){
            noiseText += chars[Math.floor(Math.random() * chars.length)];
        }
        document.getElementById('output').textContent = noiseText;

        // Optional: hier kann die Korrektur-API aufgerufen werden
        correctText(noiseText);
    }

    requestAnimationFrame(analyzeAudio);
}

// Beispiel-Funktion: Buchstaben → Satz (Platzhalter für API)
async function correctText(text) {
    // Hier würdest du eine API wie Google oder OpenAI aufrufen, z.B.:
    // fetch('/api/correct', { method:'POST', body: JSON.stringify({ text }) })
    // Für Demo:
    console.log("Zu korrigierender Text:", text);
}

document.getElementById('startBtn').addEventListener('click', startMicrophone);
</script>
</body>
</html>
