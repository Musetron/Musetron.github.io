<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Mikrofon zu Text (empfindlich)</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  #text { white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; }
</style>
</head>
<body>

<h2>Live Mikrofon zu Text</h2>
<button id="startBtn">Start</button>
<div id="text"></div>

<script type="module">
import { createWorker } from "https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.7/dist/ffmpeg.min.js";

const startBtn = document.getElementById("startBtn");
const textDiv = document.getElementById("text");

startBtn.onclick = async () => {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        alert("Mikrofon nicht verf√ºgbar");
        return;
    }

    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const source = audioContext.createMediaStreamSource(stream);
    
    const analyser = audioContext.createAnalyser();
    analyser.fftSize = 2048;
    source.connect(analyser);
    
    const dataArray = new Float32Array(analyser.fftSize);

    function detectAudio() {
        analyser.getFloatTimeDomainData(dataArray);
        let sum = 0;
        for (let i = 0; i < dataArray.length; i++) {
            sum += Math.abs(dataArray[i]);
        }
        const volume = sum / dataArray.length;
        if (volume > 0.01) { // sehr empfindlich
            textDiv.textContent += `[Audio erkannt: ${volume.toFixed(3)}]\n`;
        }
        requestAnimationFrame(detectAudio);
    }

    detectAudio();
};
</script>

</body>
</html>
