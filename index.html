<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Realtime Audio Raster</title>
<style>
  body { margin:0; background:black; overflow:hidden; }
  canvas { display:block; image-rendering:pixelated; }
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
(async function() {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');

  // sehr niedrige Auflösung für maximal FPS
  const width = 64;
  const height = 64;
  canvas.width = width;
  canvas.height = height;

  const imageData = ctx.createImageData(width, height);
  const data = imageData.data;

  // Audio
  const stream = await navigator.mediaDevices.getUserMedia({ audio:true });
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const source = audioCtx.createMediaStreamSource(stream);

  const analyser = audioCtx.createAnalyser();
  analyser.fftSize = 2048; // kleiner FFT für schnelle Samples
  source.connect(analyser);

  const buffer = new Float32Array(analyser.fftSize);

  function render() {
    analyser.getFloatTimeDomainData(buffer);

    // jede Pixel-Helligkeit = Durchschnitt von mehreren Samples
    const samplesPerPixel = Math.floor(buffer.length / (width*height));
    for(let i=0;i<width*height;i++){
      let sum=0;
      for(let j=0;j<samplesPerPixel;j++){
        sum += Math.abs(buffer[i*samplesPerPixel + j] || 0);
      }
      const brightness = Math.min(255, Math.floor(sum/samplesPerPixel * 255));
      const idx = i*4;
      data[idx]=brightness;
      data[idx+1]=brightness;
      data[idx+2]=brightness;
      data[idx+3]=255;
    }

    ctx.putImageData(imageData,0,0);
    requestAnimationFrame(render); // ~60 FPS
  }

  render();
})();
</script>
</body>
</html>
