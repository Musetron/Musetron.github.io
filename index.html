<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Mikrofon Rausch zu Text</title>
<style>
  body { font-family: monospace; background: #222; color: #0f0; padding: 20px; }
  #output { white-space: pre-wrap; line-height: 1.5; }
</style>
</head>
<body>
<h2>Mikrofon Rausch zu Buchstaben</h2>
<div id="output"></div>
<script>
const output = document.getElementById("output");

// Audio-Setup
navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const source = audioCtx.createMediaStreamSource(stream);
    const analyser = audioCtx.createAnalyser();
    analyser.fftSize = 256;
    source.connect(analyser);

    const dataArray = new Uint8Array(analyser.frequencyBinCount);
    let lastSoundTime = Date.now();
    let currentMessage = "";

    function mapLoudnessToChar(level) {
        // Mappt Pegel 50-100% auf Buchstaben und Leerzeichen
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ ";
        const index = Math.floor((level - 0.5) / 0.5 * (chars.length - 1));
        return chars[index] || " ";
    }

    function processAudio() {
        analyser.getByteTimeDomainData(dataArray);
        // RMS berechnen (Lautstärke)
        let sum = 0;
        for(let i=0; i<dataArray.length; i++) {
            const val = (dataArray[i] - 128) / 128;
            sum += val * val;
        }
        const rms = Math.sqrt(sum / dataArray.length);

        if(rms > 0.5) { // ab 50% Pegel
            lastSoundTime = Date.now();
            currentMessage += mapLoudnessToChar(rms);
            output.textContent = currentMessage;
        } else {
            // Prüfen, ob >1 Sekunde Leerlauf
            if(Date.now() - lastSoundTime > 1000 && currentMessage) {
                currentMessage += "\n--- Nachricht Ende ---\n";
                output.textContent = currentMessage;
                currentMessage = "";
            }
        }

        requestAnimationFrame(processAudio);
    }

    processAudio();
}).catch(err => {
    console.error("Mikrofon nicht verfügbar:", err);
});
</script>
</body>
</html>
